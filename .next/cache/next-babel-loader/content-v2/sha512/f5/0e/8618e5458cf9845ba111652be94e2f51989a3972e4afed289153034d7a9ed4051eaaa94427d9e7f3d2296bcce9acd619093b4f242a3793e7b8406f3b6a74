{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"/Users/keki/dev/websites/web/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/keki/dev/websites/web/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/keki/dev/websites/web/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/keki/dev/websites/web/lib/auth.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { addUser } from \"../utils/db\";\nimport firebase from \"../firebase/firebase\";\nvar authContext = /*#__PURE__*/createContext({\n  auth: null,\n  loading: true,\n  siginWithGoogle: function () {\n    var _siginWithGoogle = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function siginWithGoogle() {\n      return _siginWithGoogle.apply(this, arguments);\n    }\n\n    return siginWithGoogle;\n  }(),\n  signOut: function () {\n    var _signOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function signOut() {\n      return _signOut.apply(this, arguments);\n    }\n\n    return signOut;\n  }()\n});\n\nvar formatAuthState = function formatAuthState(user) {\n  return {\n    uid: user.uid,\n    email: user.email,\n    name: user.displayName,\n    photoUrl: user.photoURL,\n    token: null\n  };\n};\n\nfunction useProvideAuth() {\n  _s();\n\n  var _useState = useState(null),\n      auth = _useState[0],\n      setAuth = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var handleAuthChange = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(authState) {\n      var formattedAuth;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (authState) {\n                _context3.next = 3;\n                break;\n              }\n\n              setLoading(false);\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              formattedAuth = formatAuthState(authState);\n              _context3.next = 6;\n              return authState.getIdToken();\n\n            case 6:\n              formattedAuth.token = _context3.sent;\n              setAuth(formattedAuth);\n              setLoading(false);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleAuthChange(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var signedIn = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response) {\n      var provider,\n          authUser,\n          _args4 = arguments;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              provider = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : \"google\";\n\n              if (response.user) {\n                _context4.next = 3;\n                break;\n              }\n\n              throw new Error(\"No User\");\n\n            case 3:\n              authUser = formatAuthState(response.user);\n              _context4.next = 6;\n              return addUser(_objectSpread(_objectSpread({}, authUser), {}, {\n                provider: provider\n              }));\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function signedIn(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var clear = function clear() {\n    setAuth(null);\n    setLoading(true);\n  };\n\n  var siginWithGoogle = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              setLoading(true);\n              return _context5.abrupt(\"return\", firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(signedIn));\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function siginWithGoogle() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var signOut = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              return _context6.abrupt(\"return\", firebase.auth().signOut().then(clear));\n\n            case 1:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function signOut() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var unsubscribe = firebase.auth().onAuthStateChanged(handleAuthChange);\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n  return {\n    auth: auth,\n    loading: loading,\n    siginWithGoogle: siginWithGoogle,\n    signOut: signOut,\n    signedIn: signedIn\n  };\n}\n\n_s(useProvideAuth, \"1M3j6YOcUIG6FlGAoQ0D+5QxHCI=\");\n\nexport function AuthProvider(_ref5) {\n  _s2();\n\n  var children = _ref5.children;\n  var auth = useProvideAuth();\n  return /*#__PURE__*/_jsxDEV(authContext.Provider, {\n    value: auth,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 10\n  }, this);\n}\n\n_s2(AuthProvider, \"XNU4Jn8u4aVzJknlKOHFJq03xMo=\", false, function () {\n  return [useProvideAuth];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s3();\n\n  return useContext(authContext);\n};\n\n_s3(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/keki/dev/websites/web/lib/auth.tsx"],"names":["createContext","useContext","useEffect","useState","addUser","firebase","authContext","auth","loading","siginWithGoogle","signOut","formatAuthState","user","uid","email","name","displayName","photoUrl","photoURL","token","useProvideAuth","setAuth","setLoading","handleAuthChange","authState","formattedAuth","getIdToken","signedIn","response","provider","Error","authUser","clear","signInWithPopup","GoogleAuthProvider","then","unsubscribe","onAuthStateChanged","AuthProvider","children","useAuth"],"mappings":"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","sourcesContent":["import { Context, createContext, useContext, useEffect, useState } from \"react\";\nimport { addUser } from \"../utils/db\";\nimport firebase from \"../firebase/firebase\";\n\ninterface Auth {\n  uid: string;\n  email: string | null;\n  name: string | null;\n  photoUrl: string | null;\n  token: string | null;\n}\n\ninterface AuthContext {\n  auth: Auth | null;\n  loading: boolean;\n  siginWithGoogle: () => Promise<void>;\n  signOut: () => Promise<void>;\n}\n\nconst authContext: Context<AuthContext> = createContext<AuthContext>({\n  auth: null,\n  loading: true,\n  siginWithGoogle: async () => {},\n  signOut: async () => {},\n});\n\nconst formatAuthState = (user: firebase.User): Auth => ({\n  uid: user.uid,\n  email: user.email,\n  name: user.displayName,\n  photoUrl: user.photoURL,\n  token: null,\n});\n\nfunction useProvideAuth() {\n  const [auth, setAuth] = useState<Auth | null>(null);\n  const [loading, setLoading] = useState<boolean>(true);\n\n  const handleAuthChange = async (authState: firebase.User | null) => {\n    if (!authState) {\n      setLoading(false);\n      return;\n    }\n    const formattedAuth = formatAuthState(authState);\n    formattedAuth.token = await authState.getIdToken();\n    setAuth(formattedAuth);\n    setLoading(false);\n  };\n\n  const signedIn = async (\n    response: firebase.auth.UserCredential,\n    provider: String = \"google\"\n  ) => {\n    if (!response.user) {\n      throw new Error(\"No User\");\n    }\n    const authUser = formatAuthState(response.user);\n    await addUser({ ...authUser, provider });\n  };\n\n  const clear = () => {\n    setAuth(null);\n    setLoading(true);\n  };\n\n  const siginWithGoogle = async () => {\n    setLoading(true);\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.GoogleAuthProvider())\n      .then(signedIn);\n  };\n  const signOut = async () => {\n    return firebase.auth().signOut().then(clear);\n  };\n\n  useEffect(() => {\n    const unsubscribe = firebase.auth().onAuthStateChanged(handleAuthChange);\n    return () => unsubscribe();\n  }, []);\n\n  return {\n    auth,\n    loading,\n    siginWithGoogle,\n    signOut,\n    signedIn,\n  };\n}\n\nexport function AuthProvider({ children }: any) {\n  const auth = useProvideAuth();\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>;\n}\n\nexport const useAuth = () => useContext(authContext);\n"]},"metadata":{},"sourceType":"module"}